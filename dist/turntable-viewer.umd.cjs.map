{"version":3,"file":"turntable-viewer.umd.cjs","sources":["../src/progress-manager.ts","../src/utils.ts","../src/video-config-manager.ts","../src/player-initializer.ts","../src/drag-handler.ts","../src/ui-manager.ts","../src/turntable-viewer.ts"],"sourcesContent":["/**\r\n * プログレスバー管理クラス\r\n * ローディングオーバーレイとプログレスバーの表示・更新・タイムアウト検知を管理\r\n */\r\nexport class ProgressManager {\r\n    private loadingOverlay: HTMLElement;\r\n    private loadingText: HTMLElement;\r\n    private progressFill: HTMLElement;\r\n    private progressText: HTMLElement;\r\n    private container: HTMLElement;\r\n    private iframe: HTMLIFrameElement;\r\n\r\n    // タイムアウト検知用\r\n    private loadingStartTime: number | null = null;\r\n    private lastProgressTime: number = 0;\r\n    private lastProgressPercentage: number = 0;\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        iframe: HTMLIFrameElement,\r\n        loadingOverlay: HTMLElement,\r\n        loadingText: HTMLElement,\r\n        progressFill: HTMLElement,\r\n        progressText: HTMLElement\r\n    ) {\r\n        this.container = container;\r\n        this.iframe = iframe;\r\n        this.loadingOverlay = loadingOverlay;\r\n        this.loadingText = loadingText;\r\n        this.progressFill = progressFill;\r\n        this.progressText = progressText;\r\n    }\r\n\r\n    /**\r\n     * プログレスバーを更新\r\n     */\r\n    updateProgress(percentage: number, text: string | null = null): void {\r\n        console.log(`Progress update: ${percentage}% - ${text || 'No text'}`);\r\n\r\n        if (this.progressFill) {\r\n            this.progressFill.style.width = `${percentage}%`;\r\n            console.log(`Progress fill updated to ${percentage}%`);\r\n        } else {\r\n            console.warn('Progress fill element not found');\r\n        }\r\n\r\n        if (this.progressText) {\r\n            this.progressText.textContent = `${Math.round(percentage)}%`;\r\n        } else {\r\n            console.warn('Progress text element not found');\r\n        }\r\n\r\n        if (text && this.loadingText) {\r\n            this.loadingText.textContent = text;\r\n        }\r\n\r\n        // ローディングタイムアウト監視\r\n        this.checkLoadingTimeout(percentage);\r\n    }\r\n\r\n    /**\r\n     * ローディングオーバーレイを表示\r\n     */\r\n    showLoadingOverlay(): void {\r\n        if (this.loadingOverlay) {\r\n            // ローディング中はAngle表示を即座に非表示\r\n            const angleDisplay = this.container.querySelector('#angle-display') as HTMLElement;\r\n            if (angleDisplay) {\r\n                angleDisplay.style.display = 'none';\r\n            }\r\n\r\n            this.loadingOverlay.classList.remove('hidden');\r\n            this.updateProgress(0, 'Initializing video player...');\r\n\r\n            // ローディングオーバーレイのサイズを即座に調整\r\n            this.adjustLoadingOverlaySize();\r\n            // 念のため少し遅延しても再調整\r\n            setTimeout(() => this.adjustLoadingOverlaySize(), 10);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ローディングオーバーレイを隠す\r\n     */\r\n    hideLoadingOverlay(): void {\r\n        if (this.loadingOverlay) {\r\n            setTimeout(() => {\r\n                this.loadingOverlay.classList.add('hidden');\r\n\r\n                // Angle表示を再表示（存在する場合のみ）\r\n                const angleDisplay = this.container.querySelector('#angle-display') as HTMLElement;\r\n                if (angleDisplay) {\r\n                    angleDisplay.style.display = 'block';\r\n                    console.log('Angle display made visible after loading');\r\n                } else {\r\n                    console.log('Angle display element not found (optional element)');\r\n                }\r\n            }, 500); // 少し遅延してスムーズに非表示\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ローディングオーバーレイのサイズをiframe要素に合わせて調整\r\n     */\r\n    adjustLoadingOverlaySize(): void {\r\n        if (!this.loadingOverlay || !this.iframe) return;\r\n\r\n        // iframeの実際のサイズ（属性値）を取得\r\n        const iframeWidth = parseInt(this.iframe.getAttribute('width') || '0');\r\n        const iframeHeight = parseInt(this.iframe.getAttribute('height') || '0');\r\n\r\n        // どちらも設定されている場合はそのまま使用\r\n        if (iframeWidth && iframeHeight) {\r\n            this.loadingOverlay.style.width = `${iframeWidth}px`;\r\n            this.loadingOverlay.style.height = `${iframeHeight}px`;\r\n            console.log(`Adjusted loading overlay size: ${iframeWidth}x${iframeHeight}`);\r\n        } else {\r\n            // サイズが未確定の場合はデフォルト値を使用\r\n            const defaultWidth = 480;\r\n            const defaultHeight = Math.round(defaultWidth * (9 / 16));\r\n            this.loadingOverlay.style.width = `${defaultWidth}px`;\r\n            this.loadingOverlay.style.height = `${defaultHeight}px`;\r\n            console.log(`Adjusted loading overlay size to default: ${defaultWidth}x${defaultHeight}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ローディングタイムアウトをチェック\r\n     */\r\n    private checkLoadingTimeout(percentage: number): void {\r\n        // 初回またはリセット時にタイマー開始\r\n        if (!this.loadingStartTime) {\r\n            this.loadingStartTime = Date.now();\r\n            this.lastProgressTime = Date.now();\r\n            this.lastProgressPercentage = percentage;\r\n            return;\r\n        }\r\n\r\n        const now = Date.now();\r\n        const totalLoadingTime = now - this.loadingStartTime;\r\n        const timeSinceLastProgress = now - this.lastProgressTime;\r\n\r\n        // プログレスが進んだ場合は時間を更新\r\n        if (percentage > this.lastProgressPercentage) {\r\n            this.lastProgressTime = now;\r\n            this.lastProgressPercentage = percentage;\r\n            return;\r\n        }\r\n\r\n        // 30秒間プログレスが進んでいない場合、または総ローディング時間が60秒を超えた場合\r\n        const STALLED_TIMEOUT = 30000; // 30秒\r\n        const TOTAL_TIMEOUT = 60000;   // 60秒\r\n\r\n        if (timeSinceLastProgress > STALLED_TIMEOUT || totalLoadingTime > TOTAL_TIMEOUT) {\r\n            console.warn(`Loading timeout detected. Stalled: ${timeSinceLastProgress}ms, Total: ${totalLoadingTime}ms`);\r\n\r\n            // ローディングが停止していることを示す\r\n            if (this.loadingText) {\r\n                this.loadingText.textContent = 'ローディングが停止しました - リロードボタンを押してください';\r\n                this.loadingText.style.color = '#ff6b6b';\r\n            }\r\n\r\n            // タイムアウト検出をリセット（重複表示を防ぐ）\r\n            this.loadingStartTime = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * タイムアウトタイマーをリセット\r\n     */\r\n    resetTimeout(): void {\r\n        this.loadingStartTime = null;\r\n        this.lastProgressTime = 0;\r\n        this.lastProgressPercentage = 0;\r\n    }\r\n\r\n    /**\r\n     * エラー表示（ローディングオーバーレイをエラー表示に変更）\r\n     */\r\n    showError(title: string, message: string): void {\r\n        if (!this.loadingOverlay) return;\r\n\r\n        // ローディングオーバーレイをエラー表示に変更\r\n        this.loadingOverlay.innerHTML = `\r\n                <div class=\"loading-content\">\r\n                    <div class=\"loading-text\" style=\"color: #ff6b6b;\">${title}</div>\r\n                    <div style=\"color: #ffa8a8; font-size: 11px; margin-top: 8px; line-height: 1.4;\">\r\n                        ${message}\r\n                    </div>\r\n                </div>\r\n            `;\r\n        this.loadingOverlay.style.display = 'flex';\r\n        this.loadingOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.9)';\r\n\r\n        console.error(`${title}: ${message}`);\r\n    }\r\n}\r\n","/**\r\n * 共通ユーティリティ関数\r\n */\r\n\r\n/**\r\n * エラーメッセージを取得\r\n */\r\nexport function getErrorMessage(error: unknown): string {\r\n    if (error instanceof Error) return error.message;\r\n    return String(error);\r\n}\r\n\r\n/**\r\n * 遅延関数\r\n */\r\nexport function delay(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\n\r\n/**\r\n * デバウンス関数\r\n */\r\nexport function debounce<T extends (...args: any[]) => any>(\r\n    func: T,\r\n    wait: number\r\n): (...args: Parameters<T>) => void {\r\n    let timeout: ReturnType<typeof setTimeout> | undefined;\r\n    return function executedFunction(...args: Parameters<T>) {\r\n        const later = () => {\r\n            clearTimeout(timeout);\r\n            func(...args);\r\n        };\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(later, wait);\r\n    };\r\n}\r\n\r\n/**\r\n * タイムアウト付きPromise実行\r\n */\r\nexport function withTimeout<T = any>(\r\n    promise: Promise<T>,\r\n    timeoutMs: number,\r\n    errorMessage: string\r\n): Promise<T> {\r\n    return Promise.race([\r\n        promise,\r\n        new Promise<T>((_, reject) =>\r\n            setTimeout(() => reject(new Error(errorMessage || 'Operation timed out')), timeoutMs)\r\n        )\r\n    ]);\r\n}\r\n","import type { TurntableConfig, VideoInfo } from './types';\r\nimport { getErrorMessage, withTimeout, delay } from './utils';\r\n\r\n/**\r\n * 動画設定・品質・URL構築を管理するクラス\r\n */\r\nexport class VideoConfigManager {\r\n    private container: HTMLElement;\r\n    private iframe: HTMLIFrameElement;\r\n    private config: TurntableConfig;\r\n\r\n    constructor(container: HTMLElement, iframe: HTMLIFrameElement, config: TurntableConfig) {\r\n        this.container = container;\r\n        this.iframe = iframe;\r\n        this.config = config;\r\n    }\r\n\r\n    /**\r\n     * 表示サイズに基づいてPIXELS_PER_ROTATIONを動的に計算\r\n     */\r\n    calculatePixelsPerRotation(): number {\r\n        const htmlWidth = parseInt(this.iframe.getAttribute('width') || '0');\r\n        const containerWidth = this.container.clientWidth || 0;\r\n        const iframeWidth = this.iframe.clientWidth || 0;\r\n        const computedWidth = Math.max(containerWidth, iframeWidth) || 0;\r\n\r\n        const finalWidth = htmlWidth || computedWidth || 320;\r\n\r\n        console.log(`Container width for calculation: ${finalWidth}px (html: ${htmlWidth}, container: ${containerWidth}, iframe: ${iframeWidth})`);\r\n\r\n        const basePixels = 1200;\r\n        const baseScreenSize = 640;\r\n\r\n        let pixelsPerRotation = (finalWidth / baseScreenSize) * basePixels;\r\n\r\n        if (finalWidth <= 480) {\r\n            pixelsPerRotation *= 1.2;\r\n        }\r\n\r\n        pixelsPerRotation = Math.max(250, Math.min(3000, pixelsPerRotation));\r\n\r\n        console.log(`Calculated PIXELS_PER_ROTATION: ${Math.round(pixelsPerRotation)} for width: ${finalWidth}px`);\r\n        return Math.round(pixelsPerRotation);\r\n    }\r\n\r\n    /**\r\n     * 表示サイズに応じた動画品質選択\r\n     */\r\n    selectVideoQuality(): string {\r\n        const videoWidth = parseInt(this.container.getAttribute('video-width') || '0');\r\n        const videoHeight = parseInt(this.container.getAttribute('video-height') || '0');\r\n        const htmlWidth = parseInt(this.iframe.getAttribute('width') || '0');\r\n        const htmlHeight = parseInt(this.iframe.getAttribute('height') || '0');\r\n        const computedWidth = this.iframe.clientWidth || this.container.clientWidth || 0;\r\n        const computedHeight = this.iframe.clientHeight || this.container.clientHeight || 0;\r\n\r\n        const finalWidth = videoWidth || htmlWidth || computedWidth || 480;\r\n        const finalHeight = videoHeight || htmlHeight || finalWidth;\r\n\r\n        const area = finalWidth * finalHeight;\r\n        const effectiveArea = Math.sqrt(area);\r\n\r\n        const devicePixelRatio = window.devicePixelRatio || 1;\r\n\r\n        let effectiveSize;\r\n        if ((htmlWidth && htmlHeight) || (videoWidth && videoHeight)) {\r\n            const limitedDPR = Math.min(devicePixelRatio, 1.5);\r\n            effectiveSize = effectiveArea * limitedDPR;\r\n        } else {\r\n            effectiveSize = effectiveArea * devicePixelRatio;\r\n        }\r\n\r\n        let selectedQuality = '240p';\r\n        if (effectiveSize <= 240) {\r\n            selectedQuality = '240p';\r\n        } else if (effectiveSize <= 360) {\r\n            selectedQuality = '360p';\r\n        } else if (effectiveSize <= 480) {\r\n            selectedQuality = '540p';\r\n        } else if (effectiveSize <= 960) {\r\n            selectedQuality = '720p';\r\n        } else if (effectiveSize <= 1280) {\r\n            selectedQuality = '1080p';\r\n        } else if (effectiveSize <= 1920) {\r\n            selectedQuality = '2k';\r\n        } else {\r\n            selectedQuality = '4k';\r\n        }\r\n\r\n        console.log(`Selected quality: ${selectedQuality} for effective size: ${effectiveSize}px (${finalWidth}x${finalHeight})`);\r\n        return selectedQuality;\r\n    }\r\n\r\n    /**\r\n     * 動画URLを構築\r\n     */\r\n    buildVideoUrl(): string {\r\n        const quality = this.selectVideoQuality();\r\n\r\n        const videoWidth = parseInt(this.container.getAttribute('video-width') || '0');\r\n        const videoHeight = parseInt(this.container.getAttribute('video-height') || '0');\r\n        const htmlWidth = parseInt(this.iframe.getAttribute('width') || '0');\r\n        const htmlHeight = parseInt(this.iframe.getAttribute('height') || '0');\r\n\r\n        let finalWidth = videoWidth || htmlWidth || 480;\r\n        let finalHeight = videoHeight || htmlHeight || finalWidth;\r\n\r\n        const screenWidth = window.innerWidth || document.documentElement.clientWidth;\r\n        if (screenWidth <= 768) {\r\n            const containerWidth = this.container.clientWidth || this.container.parentElement?.clientWidth || screenWidth;\r\n            const availableWidth = Math.floor(containerWidth * 0.9);\r\n            if (availableWidth > 200) {\r\n                finalWidth = availableWidth;\r\n                finalHeight = availableWidth;\r\n            }\r\n        }\r\n\r\n        this.iframe.setAttribute('width', finalWidth.toString());\r\n        this.iframe.setAttribute('height', finalHeight.toString());\r\n\r\n        if (screenWidth <= 768) {\r\n            this.iframe.style.width = finalWidth + 'px';\r\n            this.iframe.style.height = finalHeight + 'px';\r\n            this.iframe.style.maxWidth = 'none';\r\n            this.iframe.style.display = 'block';\r\n            console.log(`Applied direct CSS styles: ${finalWidth}x${finalHeight}`);\r\n        }\r\n\r\n        const params = new URLSearchParams({\r\n            background: '1',\r\n            byline: '0',\r\n            portrait: '0',\r\n            title: '0',\r\n            speed: '0',\r\n            transparent: '1',\r\n            gesture: 'media',\r\n            autopause: '0',\r\n            muted: '1',\r\n            loop: '1',\r\n            controls: '0',\r\n            quality: quality,\r\n            responsive: '0',\r\n            dnt: '1'\r\n        });\r\n\r\n        const url = `https://player.vimeo.com/video/${this.config.videoId}?${params.toString()}`;\r\n        console.log(`Video URL set: ${url} (Size: ${finalWidth}x${finalHeight}, Screen: ${screenWidth})`);\r\n        return url;\r\n    }\r\n\r\n    /**\r\n     * Vimeo oEmbed APIから動画情報を事前取得\r\n     */\r\n    async getVideoInfoFromAPI(): Promise<VideoInfo> {\r\n        try {\r\n            if (!/^\\d+$/.test(this.config.videoId)) {\r\n                throw new Error('Invalid video ID format for API call');\r\n            }\r\n\r\n            const oembedUrl = `https://vimeo.com/api/oembed.json?url=https://vimeo.com/${this.config.videoId}`;\r\n            console.log(`Fetching video info from: ${oembedUrl}`);\r\n\r\n            await delay(Math.random() * 500);\r\n\r\n            const controller = new AbortController();\r\n            const timeoutId = setTimeout(() => controller.abort(), 10000);\r\n\r\n            const response = await fetch(oembedUrl, {\r\n                signal: controller.signal,\r\n                referrerPolicy: 'no-referrer',\r\n                headers: {\r\n                    'Accept': 'application/json'\r\n                }\r\n            });\r\n\r\n            clearTimeout(timeoutId);\r\n\r\n            if (!response.ok) {\r\n                if (response.status === 404) {\r\n                    throw new Error(`Video not found (ID: ${this.config.videoId}). Please check the video ID.`);\r\n                } else if (response.status === 403) {\r\n                    throw new Error(`Access denied to video (ID: ${this.config.videoId}). Video may be private.`);\r\n                } else if (response.status >= 500) {\r\n                    throw new Error(`Vimeo server error (status: ${response.status}). Please try again later.`);\r\n                } else {\r\n                    throw new Error(`HTTP error! status: ${response.status}`);\r\n                }\r\n            }\r\n\r\n            const data = await response.json();\r\n\r\n            if (!data || typeof data !== 'object') {\r\n                throw new Error('Invalid API response format');\r\n            }\r\n\r\n            if (!data.width || !data.height || data.width <= 0 || data.height <= 0) {\r\n                throw new Error('Invalid video dimensions in API response');\r\n            }\r\n\r\n            const aspectRatio = data.height / data.width;\r\n\r\n            console.log(`API Video dimensions: ${data.width}x${data.height}, aspect ratio: ${aspectRatio.toFixed(3)}`);\r\n\r\n            return {\r\n                width: data.width,\r\n                height: data.height,\r\n                aspectRatio: aspectRatio,\r\n                title: data.title || 'Untitled Video'\r\n            };\r\n        } catch (error) {\r\n            if ((error as any).name === 'AbortError') {\r\n                console.warn('API request timed out, using default aspect ratio');\r\n            } else {\r\n                console.warn('Could not fetch video info from API:', getErrorMessage(error));\r\n            }\r\n\r\n            return {\r\n                width: 1920,\r\n                height: 1080,\r\n                aspectRatio: 9 / 16,\r\n                title: 'Untitled Video'\r\n            };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 初期サイズを設定（API情報から）\r\n     */\r\n    async setInitialSizeFromAPI(\r\n        onProgress?: (progress: number, message: string) => void,\r\n        onAdjustOverlay?: () => void\r\n    ): Promise<void> {\r\n        try {\r\n            const currentWidth = parseInt(this.iframe.getAttribute('width') || '0');\r\n            const currentHeight = parseInt(this.iframe.getAttribute('height') || '0');\r\n\r\n            this.iframe.style.visibility = 'hidden';\r\n\r\n            if (currentWidth && currentHeight) {\r\n                console.log(`Both width and height specified: ${currentWidth}x${currentHeight}`);\r\n                this.container.classList.add('initialized');\r\n                this.iframe.style.visibility = 'visible';\r\n                this.iframe.classList.add('size-ready');\r\n                console.log('Container and iframe ready with fixed size');\r\n                onAdjustOverlay?.();\r\n                return;\r\n            }\r\n\r\n            if (currentWidth || currentHeight) {\r\n                onProgress?.(5, 'Getting video information...');\r\n\r\n                const videoInfo = await this.getVideoInfoFromAPI();\r\n\r\n                if (currentWidth && !currentHeight) {\r\n                    const calculatedHeight = Math.round(currentWidth * videoInfo.aspectRatio);\r\n                    this.iframe.setAttribute('height', calculatedHeight.toString());\r\n                    console.log(`Set height from width: ${currentWidth}x${calculatedHeight} (aspect ratio: ${videoInfo.aspectRatio.toFixed(3)})`);\r\n                } else if (currentHeight && !currentWidth) {\r\n                    const calculatedWidth = Math.round(currentHeight / videoInfo.aspectRatio);\r\n                    this.iframe.setAttribute('width', calculatedWidth.toString());\r\n                    console.log(`Set width from height: ${calculatedWidth}x${currentHeight} (aspect ratio: ${videoInfo.aspectRatio.toFixed(3)})`);\r\n                }\r\n\r\n                this.container.classList.add('initialized');\r\n                this.iframe.style.visibility = 'visible';\r\n                this.iframe.classList.add('size-ready');\r\n                console.log('Container and iframe size ready, made visible');\r\n\r\n                onAdjustOverlay?.();\r\n            } else {\r\n                const defaultWidth = 480;\r\n                onProgress?.(5, 'Getting video information...');\r\n\r\n                const videoInfo = await this.getVideoInfoFromAPI();\r\n                const calculatedHeight = Math.round(defaultWidth * videoInfo.aspectRatio);\r\n\r\n                this.iframe.setAttribute('width', defaultWidth.toString());\r\n                this.iframe.setAttribute('height', calculatedHeight.toString());\r\n                console.log(`Set default size: ${defaultWidth}x${calculatedHeight} (aspect ratio: ${videoInfo.aspectRatio.toFixed(3)})`);\r\n\r\n                this.container.classList.add('initialized');\r\n                this.iframe.style.visibility = 'visible';\r\n                this.iframe.classList.add('size-ready');\r\n                console.log('Container and iframe size ready with default size');\r\n\r\n                onAdjustOverlay?.();\r\n            }\r\n\r\n            console.log('setInitialSizeFromAPI completed');\r\n        } catch (error) {\r\n            console.warn('Could not set initial size from API:', error);\r\n            this.setInitialSizeFallback(onAdjustOverlay);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 初期サイズを設定（フォールバック版）\r\n     */\r\n    setInitialSizeFallback(onAdjustOverlay?: () => void): void {\r\n        try {\r\n            const currentWidth = parseInt(this.iframe.getAttribute('width') || '0');\r\n            const currentHeight = parseInt(this.iframe.getAttribute('height') || '0');\r\n\r\n            if (currentWidth && currentHeight) {\r\n                console.log(`Fallback: Both width and height specified: ${currentWidth}x${currentHeight}`);\r\n            } else if (currentWidth && !currentHeight) {\r\n                const defaultHeight = Math.round(currentWidth * (9 / 16));\r\n                this.iframe.setAttribute('height', defaultHeight.toString());\r\n                console.log(`Fallback: Set height from width: ${currentWidth}x${defaultHeight} (16:9 default aspect ratio)`);\r\n            } else if (currentHeight && !currentWidth) {\r\n                const defaultWidth = Math.round(currentHeight / (9 / 16));\r\n                this.iframe.setAttribute('width', defaultWidth.toString());\r\n                console.log(`Fallback: Set width from height: ${defaultWidth}x${currentHeight} (16:9 default aspect ratio)`);\r\n            } else {\r\n                const defaultWidth = 480;\r\n                const defaultHeight = Math.round(defaultWidth * (9 / 16));\r\n                this.iframe.setAttribute('width', defaultWidth.toString());\r\n                this.iframe.setAttribute('height', defaultHeight.toString());\r\n                console.log(`Fallback: Set default size: ${defaultWidth}x${defaultHeight} (16:9 default aspect ratio)`);\r\n            }\r\n\r\n            this.container.classList.add('initialized');\r\n            this.iframe.style.visibility = 'visible';\r\n            this.iframe.classList.add('size-ready');\r\n            console.log('Container and iframe size ready (fallback), made visible');\r\n\r\n            onAdjustOverlay?.();\r\n        } catch (error) {\r\n            console.warn('Could not set fallback initial size:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 動画プレイヤーのセットアップ\r\n     */\r\n    setupVideoPlayer(): void {\r\n        const videoUrl = this.buildVideoUrl();\r\n        this.iframe.src = videoUrl;\r\n    }\r\n}\r\n","import type { TurntableState } from './types';\r\nimport { getErrorMessage, withTimeout, delay } from './utils';\r\n\r\n/**\r\n * プレイヤー初期化と事前ロードを管理するクラス\r\n */\r\nexport class PlayerInitializer {\r\n    private iframe: HTMLIFrameElement;\r\n    private container: HTMLElement;\r\n\r\n    constructor(container: HTMLElement, iframe: HTMLIFrameElement) {\r\n        this.container = container;\r\n        this.iframe = iframe;\r\n    }\r\n\r\n    /**\r\n     * Vimeoプレイヤーを作成\r\n     */\r\n    async createPlayer(onProgress?: (progress: number, message: string) => void): Promise<any> {\r\n        try {\r\n            onProgress?.(40, 'Connecting to player...');\r\n            // @ts-ignore - VimeoはグローバルにCDNから読み込まれている\r\n            const player = new Vimeo.Player(this.iframe);\r\n            return player;\r\n        } catch (error) {\r\n            throw new Error(`Failed to create Vimeo player: ${getErrorMessage(error)}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * プレイヤーの基本情報取得\r\n     */\r\n    async getPlayerDuration(player: any, isReloading: boolean = false, onProgress?: (progress: number, message: string) => void): Promise<number> {\r\n        onProgress?.(60, 'Loading player settings...');\r\n\r\n        // リロード時はタイムアウトを長くする\r\n        const timeout = isReloading ? 15000 : 10000;\r\n        const duration = await withTimeout(\r\n            player.getDuration(),\r\n            timeout,\r\n            'Failed to get video duration'\r\n        );\r\n        console.log('Duration:', duration);\r\n\r\n        if (!duration || duration <= 0) {\r\n            throw new Error('Invalid video duration received');\r\n        }\r\n\r\n        return duration;\r\n    }\r\n\r\n    /**\r\n     * 動画のアスペクト比を調整（プレイヤー情報から詳細確認）\r\n     */\r\n    async adjustVideoAspectRatio(player: any, onAdjustOverlay?: () => void): Promise<void> {\r\n        try {\r\n            console.log('Getting video dimensions...');\r\n            const videoWidth = await withTimeout(\r\n                player.getVideoWidth(),\r\n                3000,\r\n                'Failed to get video width'\r\n            );\r\n            const videoHeight = await withTimeout(\r\n                player.getVideoHeight(),\r\n                3000,\r\n                'Failed to get video height'\r\n            );\r\n            const aspectRatio = videoHeight / videoWidth;\r\n\r\n            console.log(`Player Video dimensions: ${videoWidth}x${videoHeight}, aspect ratio: ${aspectRatio.toFixed(3)}`);\r\n\r\n            const currentWidth = parseInt(this.iframe.getAttribute('width') || '480');\r\n            const currentHeight = parseInt(this.iframe.getAttribute('height') || '480');\r\n            const currentAspectRatio = currentHeight / currentWidth;\r\n            const specifiedVideoHeight = parseInt(this.container.getAttribute('video-height') || '0');\r\n\r\n            if (!specifiedVideoHeight && Math.abs(currentAspectRatio - aspectRatio) > 0.01) {\r\n                const calculatedHeight = Math.round(currentWidth * aspectRatio);\r\n                this.iframe.setAttribute('height', calculatedHeight.toString());\r\n                console.log(`Fine-tuned iframe size: ${currentWidth}x${calculatedHeight} (aspect ratio: ${aspectRatio.toFixed(3)})`);\r\n\r\n                onAdjustOverlay?.();\r\n            } else {\r\n                console.log('Aspect ratio already correct, no adjustment needed');\r\n            }\r\n        } catch (error) {\r\n            console.warn('Could not get video dimensions, keeping current size:', getErrorMessage(error));\r\n            onAdjustOverlay?.();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * プレイヤー設定を個別にエラーハンドリング付きで適用\r\n     */\r\n    async applyPlayerSettings(player: any, onProgress?: (progress: number, message: string) => void): Promise<void> {\r\n        onProgress?.(75, 'Applying player settings...');\r\n\r\n        const settings = [\r\n            {\r\n                name: 'loop',\r\n                action: () => player.setLoop(true),\r\n                fallback: () => console.warn('Could not set loop mode')\r\n            },\r\n            {\r\n                name: 'volume',\r\n                action: () => player.setVolume(0),\r\n                fallback: () => console.warn('Could not set volume')\r\n            }\r\n        ];\r\n\r\n        for (const setting of settings) {\r\n            try {\r\n                await withTimeout(setting.action(), 3000, `Failed to set ${setting.name}`);\r\n                console.log(`Successfully set ${setting.name}`);\r\n            } catch (error) {\r\n                console.warn(`Setting ${setting.name} failed:`, getErrorMessage(error));\r\n                setting.fallback();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 動画の事前ロード（失敗しても続行可能）\r\n     */\r\n    async preloadVideo(player: any, duration: number, onProgress?: (progress: number, message: string) => void): Promise<boolean> {\r\n        try {\r\n            onProgress?.(85, 'Buffering video...');\r\n            console.log('Starting video buffer preload...');\r\n\r\n            // 再生せずにseekだけでバッファリング（ブラウザの自動再生ブロックを回避）\r\n            const preloadPoints = [0, 0.5];\r\n            for (let i = 0; i < preloadPoints.length; i++) {\r\n                const point = preloadPoints[i];\r\n                const seekTime = duration * point;\r\n                await withTimeout(\r\n                    player.setCurrentTime(seekTime),\r\n                    5000,\r\n                    `Preload seek timeout at ${point * 100}%`\r\n                );\r\n                await delay(300);\r\n\r\n                onProgress?.(85 + (i + 1) * 2, `Buffering ${Math.round(point * 100)}%...`);\r\n            }\r\n\r\n            await withTimeout(player.setCurrentTime(0), 5000, 'Preload final seek timeout');\r\n\r\n            console.log('Video buffer preload completed');\r\n            return true;\r\n        } catch (error) {\r\n            // バッファリングはオプショナルなので、失敗しても問題ない\r\n            console.log('Video buffer preload skipped:', getErrorMessage(error));\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 初期プレイヤー状態の設定\r\n     */\r\n    async setInitialPlayerState(player: any, onProgress?: (progress: number, message: string) => void): Promise<void> {\r\n        onProgress?.(90, 'Setting initial state...');\r\n\r\n        // playはブラウザの自動再生ポリシーでブロックされる可能性があるが、\r\n        // pauseとseekが成功すればウィジェットは機能する\r\n        const actions = [\r\n            { name: 'play', action: () => player.play(), optional: true },\r\n            { name: 'pause', action: () => player.pause(), optional: false },\r\n            { name: 'seek to start', action: () => player.setCurrentTime(0), optional: false }\r\n        ];\r\n\r\n        for (const action of actions) {\r\n            try {\r\n                await withTimeout(action.action(), 3000, `Failed to ${action.name}`);\r\n                console.log(`Successfully executed: ${action.name}`);\r\n            } catch (error) {\r\n                if (action.optional) {\r\n                    // オプショナルな操作（play等）の失敗は通常動作\r\n                    console.log(`${action.name} skipped (likely blocked by browser autoplay policy)`);\r\n                } else {\r\n                    // 必須の操作（pause/seek）の失敗は警告\r\n                    console.warn(`Action ${action.name} failed:`, getErrorMessage(error));\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","import type { TurntableConfig, TurntableState } from './types';\r\n\r\n/**\r\n * ドラッグ操作とイベント処理を管理するクラス\r\n */\r\nexport class DragHandler {\r\n    private container: HTMLElement;\r\n    private dragOverlay: HTMLElement;\r\n    private state: TurntableState;\r\n    private config: TurntableConfig;\r\n    private calculatePixelsPerRotation: () => number;\r\n    private onAngleUpdate: (seconds: number) => void;\r\n\r\n    // バインド済みのイベントハンドラー\r\n    private boundMouseDown: (e: MouseEvent) => Promise<void>;\r\n    private boundMouseMove: (e: MouseEvent) => void;\r\n    private boundMouseUp: () => void;\r\n    private boundTouchStart: (e: TouchEvent) => Promise<void>;\r\n    private boundTouchMove: (e: TouchEvent) => void;\r\n    private boundTouchEnd: (e: TouchEvent) => void;\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        dragOverlay: HTMLElement,\r\n        state: TurntableState,\r\n        config: TurntableConfig,\r\n        calculatePixelsPerRotation: () => number,\r\n        onAngleUpdate: (seconds: number) => void\r\n    ) {\r\n        this.container = container;\r\n        this.dragOverlay = dragOverlay;\r\n        this.state = state;\r\n        this.config = config;\r\n        this.calculatePixelsPerRotation = calculatePixelsPerRotation;\r\n        this.onAngleUpdate = onAngleUpdate;\r\n\r\n        // イベントハンドラーをバインド\r\n        this.boundMouseDown = this.onMouseDown.bind(this);\r\n        this.boundMouseMove = this.onMouseMove.bind(this);\r\n        this.boundMouseUp = this.onMouseUp.bind(this);\r\n        this.boundTouchStart = this.onTouchStart.bind(this);\r\n        this.boundTouchMove = this.onTouchMove.bind(this);\r\n        this.boundTouchEnd = this.onTouchEnd.bind(this);\r\n    }\r\n\r\n    /**\r\n     * イベントリスナーを追加\r\n     */\r\n    attachEventListeners(): void {\r\n        this.dragOverlay.addEventListener('mousedown', this.boundMouseDown);\r\n        this.dragOverlay.addEventListener('touchstart', this.boundTouchStart, { passive: false });\r\n    }\r\n\r\n    /**\r\n     * イベントリスナーを削除\r\n     */\r\n    removeEventListeners(): void {\r\n        this.dragOverlay.removeEventListener('mousedown', this.boundMouseDown);\r\n        this.dragOverlay.removeEventListener('touchstart', this.boundTouchStart);\r\n        document.removeEventListener('mousemove', this.boundMouseMove);\r\n        document.removeEventListener('mouseup', this.boundMouseUp);\r\n        document.removeEventListener('touchmove', this.boundTouchMove);\r\n        document.removeEventListener('touchend', this.boundTouchEnd);\r\n    }\r\n\r\n    /**\r\n     * 新しい再生時間を計算（ループ対応）\r\n     */\r\n    private calculateNewTime(deltaX: number): number {\r\n        const sensitivityFactor = 0.9;\r\n        const pixelsPerRotation = this.calculatePixelsPerRotation();\r\n        const adjustedDelta = deltaX * sensitivityFactor;\r\n        const rotationProgress = adjustedDelta / pixelsPerRotation;\r\n\r\n        const timeDelta = this.config.isClockwise\r\n            ? -rotationProgress * this.state.duration\r\n            : rotationProgress * this.state.duration;\r\n\r\n        let newTime = this.state.startTime + timeDelta;\r\n\r\n        return ((newTime % this.state.duration) + this.state.duration) % this.state.duration;\r\n    }\r\n\r\n    /**\r\n     * ドラッグ操作の共通処理\r\n     */\r\n    private handleDragMove(currentX: number): void {\r\n        if (!this.state.isDragging || !this.state.isPlayerReady) return;\r\n\r\n        if (this.state.startTime === undefined || this.state.startTime === null) return;\r\n        if (this.state.dragStartX === undefined || this.state.dragStartX === null) return;\r\n\r\n        const deltaX = currentX - this.state.dragStartX;\r\n\r\n        if (Math.abs(deltaX) > 2000) {\r\n            console.warn('Extreme deltaX detected, ignoring:', deltaX);\r\n            return;\r\n        }\r\n\r\n        const newTime = this.calculateNewTime(deltaX);\r\n\r\n        // UI更新を即座に実行\r\n        this.onAngleUpdate(newTime);\r\n\r\n        const now = performance.now();\r\n        const shouldThrottle = now - this.state.lastDragUpdate < 100;\r\n\r\n        if (!shouldThrottle) {\r\n            this.state.lastDragUpdate = now;\r\n\r\n            if (this.state.pendingApiCall) {\r\n                cancelAnimationFrame(this.state.pendingApiCall);\r\n            }\r\n\r\n            this.state.pendingApiCall = requestAnimationFrame(() => {\r\n                if (this.state.isDragging && this.state.isPlayerReady) {\r\n                    this.state.player?.setCurrentTime(newTime).catch((err: any) => {\r\n                        console.warn('Vimeo API call ignored due to performance:', err);\r\n                    });\r\n                }\r\n                this.state.pendingApiCall = null;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ドラッグ開始の共通処理\r\n     */\r\n    private async handleDragStart(startX: number): Promise<boolean> {\r\n        if (!this.state.isPlayerReady) return false;\r\n\r\n        this.state.isDragging = false;\r\n        this.state.dragStartX = startX;\r\n        this.dragOverlay.style.cursor = 'grabbing';\r\n\r\n        try {\r\n            this.state.startTime = await this.state.player.getCurrentTime();\r\n            this.state.isDragging = true;\r\n\r\n            this.dragOverlay.classList.add('dragging');\r\n            this.container.classList.add('dragging');\r\n\r\n            this.state.dragStartX = startX;\r\n\r\n            console.log('Drag started at time:', this.state.startTime, 'position:', startX);\r\n            return true;\r\n        } catch (error) {\r\n            console.error('Failed to get current time:', error);\r\n            this.state.isDragging = false;\r\n            this.dragOverlay.classList.remove('dragging');\r\n            this.container.classList.remove('dragging');\r\n            this.dragOverlay.style.cursor = 'grab';\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ドラッグ終了の共通処理\r\n     */\r\n    private handleDragEnd(): void {\r\n        if (!this.state.isDragging) return;\r\n\r\n        this.state.isDragging = false;\r\n\r\n        this.dragOverlay.classList.remove('dragging');\r\n        this.container.classList.remove('dragging');\r\n\r\n        if (this.state.pendingApiCall) {\r\n            cancelAnimationFrame(this.state.pendingApiCall);\r\n            this.state.pendingApiCall = null;\r\n        }\r\n\r\n        this.dragOverlay.style.cursor = 'grab';\r\n        this.state.player?.pause();\r\n    }\r\n\r\n    /**\r\n     * マウスダウンイベントハンドラー\r\n     */\r\n    private async onMouseDown(e: MouseEvent): Promise<void> {\r\n        if (this.state.isDragging) return;\r\n\r\n        const success = await this.handleDragStart(e.clientX);\r\n        if (!success) return;\r\n\r\n        document.addEventListener('mousemove', this.boundMouseMove);\r\n        document.addEventListener('mouseup', this.boundMouseUp);\r\n        e.preventDefault();\r\n    }\r\n\r\n    /**\r\n     * マウスムーブイベントハンドラー\r\n     */\r\n    private onMouseMove(e: MouseEvent): void {\r\n        this.handleDragMove(e.clientX);\r\n    }\r\n\r\n    /**\r\n     * マウスアップイベントハンドラー\r\n     */\r\n    private onMouseUp(): void {\r\n        this.handleDragEnd();\r\n        document.removeEventListener('mousemove', this.boundMouseMove);\r\n        document.removeEventListener('mouseup', this.boundMouseUp);\r\n    }\r\n\r\n    /**\r\n     * タッチスタートイベントハンドラー\r\n     */\r\n    private async onTouchStart(e: TouchEvent): Promise<void> {\r\n        if (this.state.isDragging) return;\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const success = await this.handleDragStart(e.touches[0].clientX);\r\n        if (!success) return;\r\n\r\n        document.addEventListener('touchmove', this.boundTouchMove, { passive: false });\r\n        document.addEventListener('touchend', this.boundTouchEnd, { passive: false });\r\n    }\r\n\r\n    /**\r\n     * タッチムーブイベントハンドラー\r\n     */\r\n    private onTouchMove(e: TouchEvent): void {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        this.handleDragMove(e.touches[0].clientX);\r\n    }\r\n\r\n    /**\r\n     * タッチエンドイベントハンドラー\r\n     */\r\n    private onTouchEnd(e: TouchEvent): void {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        this.handleDragEnd();\r\n        document.removeEventListener('touchmove', this.boundTouchMove);\r\n        document.removeEventListener('touchend', this.boundTouchEnd);\r\n    }\r\n}\r\n","import type { TurntableConfig, TurntableState } from './types';\r\nimport { ProgressManager } from './progress-manager';\r\n\r\n/**\r\n * UI更新を管理するクラス（角度表示、リロードボタン、Vimeoリンク）\r\n */\r\nexport class UIManager {\r\n    private container: HTMLElement;\r\n    private iframe: HTMLIFrameElement;\r\n    private angleEl: HTMLElement | null;\r\n    private angleDisplay: HTMLElement | null;\r\n    private reloadButton: HTMLButtonElement;\r\n    private config: TurntableConfig;\r\n    private state: TurntableState;\r\n    private progressManager: ProgressManager;\r\n    private onReload: () => Promise<void>;\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        iframe: HTMLIFrameElement,\r\n        angleEl: HTMLElement | null,\r\n        angleDisplay: HTMLElement | null,\r\n        config: TurntableConfig,\r\n        state: TurntableState,\r\n        progressManager: ProgressManager,\r\n        onReload: () => Promise<void>\r\n    ) {\r\n        this.container = container;\r\n        this.iframe = iframe;\r\n        this.angleEl = angleEl;\r\n        this.angleDisplay = angleDisplay;\r\n        this.config = config;\r\n        this.state = state;\r\n        this.progressManager = progressManager;\r\n        this.onReload = onReload;\r\n\r\n        // リロードボタンを作成\r\n        this.reloadButton = document.createElement('button');\r\n        this.createReloadButton();\r\n    }\r\n\r\n    /**\r\n     * リロードボタンを作成\r\n     */\r\n    private createReloadButton(): void {\r\n        this.reloadButton.className = 'reload-button';\r\n        this.reloadButton.title = 'ビデオを再読み込み';\r\n\r\n        this.reloadButton.innerHTML = `\r\n            <svg class=\"reload-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                <path d=\"M23 4v6h-6\"/>\r\n                <path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\r\n            </svg>\r\n        `;\r\n\r\n        this.reloadButton.addEventListener('click', () => {\r\n            this.onReload();\r\n        });\r\n\r\n        this.container.appendChild(this.reloadButton);\r\n    }\r\n\r\n    /**\r\n     * リロードボタンを表示\r\n     */\r\n    showReloadButton(): void {\r\n        if (this.reloadButton) {\r\n            this.reloadButton.style.display = 'flex';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * リロードボタンを非表示\r\n     */\r\n    hideReloadButton(): void {\r\n        if (this.reloadButton) {\r\n            this.reloadButton.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * リロード処理のローディング状態を設定\r\n     */\r\n    setReloadLoading(isLoading: boolean): void {\r\n        if (isLoading) {\r\n            this.reloadButton.classList.add('loading');\r\n        } else {\r\n            this.reloadButton.classList.remove('loading');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 角度表示更新\r\n     */\r\n    updateAngle(seconds: number): void {\r\n        let angle;\r\n\r\n        if (this.config.isClockwise) {\r\n            angle = (seconds / this.state.duration) * 360;\r\n        } else {\r\n            angle = 360 - (seconds / this.state.duration) * 360;\r\n        }\r\n\r\n        angle = angle % 360;\r\n        if (angle < 0) angle += 360;\r\n\r\n        if (!this.angleEl) return;\r\n\r\n        const roundedAngle = Math.round(angle);\r\n        if (this.state.isDragging) {\r\n            this.angleEl.textContent = roundedAngle.toString();\r\n            this.state.lastDisplayedAngle = roundedAngle;\r\n        } else {\r\n            if (this.state.lastDisplayedAngle !== roundedAngle) {\r\n                this.angleEl.textContent = roundedAngle.toString();\r\n                this.state.lastDisplayedAngle = roundedAngle;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 角度表示の位置を調整\r\n     */\r\n    adjustAngleDisplayPosition(): void {\r\n        if (!this.angleDisplay || !this.iframe) {\r\n            console.log('angleDisplay or iframe not found, skipping position adjustment');\r\n            return;\r\n        }\r\n\r\n        const wasHidden = this.angleDisplay.style.display === 'none';\r\n        if (wasHidden) {\r\n            this.angleDisplay.style.visibility = 'hidden';\r\n            this.angleDisplay.style.display = 'block';\r\n        }\r\n\r\n        console.log('Angle display positioned at bottom center via CSS');\r\n\r\n        if (wasHidden) {\r\n            this.angleDisplay.style.display = 'none';\r\n            this.angleDisplay.style.visibility = 'visible';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 角度表示を表示\r\n     */\r\n    showAngleDisplay(): void {\r\n        if (this.angleDisplay) {\r\n            this.adjustAngleDisplayPosition();\r\n            this.angleDisplay.style.display = 'block';\r\n            console.log('Angle display enabled after successful initialization and position adjustment');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 角度表示を非表示\r\n     */\r\n    hideAngleDisplay(): void {\r\n        if (this.angleDisplay) {\r\n            this.angleDisplay.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Vimeoリンクを表示\r\n     */\r\n    showVimeoLink(): void {\r\n        const vimeoLink = (this.container.parentNode?.querySelector('.vimeo-link') ||\r\n            this.container.querySelector('.vimeo-link')) as HTMLAnchorElement;\r\n        if (vimeoLink && this.config.videoId) {\r\n            if (!/^\\d+$/.test(this.config.videoId)) {\r\n                console.warn('Invalid video ID format detected, skipping Vimeo link generation');\r\n                return;\r\n            }\r\n\r\n            vimeoLink.href = `https://vimeo.com/${this.config.videoId}`;\r\n\r\n            if (this.iframe) {\r\n                const videoWidth = this.iframe.offsetWidth;\r\n                if (videoWidth > 0) {\r\n                    vimeoLink.style.width = `${videoWidth}px`;\r\n                    console.log(`Vimeo link width adjusted to ${videoWidth}px`);\r\n                }\r\n            }\r\n\r\n            vimeoLink.classList.add('visible');\r\n            console.log('Vimeo link displayed');\r\n        } else if (!vimeoLink) {\r\n            console.log('Vimeo link element not found (optional element)');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ローディングオーバーレイを隠す（UI調整含む）\r\n     */\r\n    hideLoadingOverlay(): void {\r\n        this.progressManager.hideLoadingOverlay();\r\n\r\n        if (this.angleDisplay) {\r\n            this.adjustAngleDisplayPosition();\r\n        }\r\n\r\n        this.showVimeoLink();\r\n    }\r\n\r\n    /**\r\n     * エラー表示\r\n     */\r\n    showError(title: string, message: string): void {\r\n        this.progressManager.showError(title, message);\r\n    }\r\n}\r\n","// CSSをインポート\r\nimport './turntable-viewer.css';\r\nimport type { TurntableConfig, TurntableState } from './types';\r\nimport { ProgressManager } from './progress-manager';\r\nimport { VideoConfigManager } from './video-config-manager';\r\nimport { PlayerInitializer } from './player-initializer';\r\nimport { DragHandler } from './drag-handler';\r\nimport { UIManager } from './ui-manager';\r\nimport { getErrorMessage, delay } from './utils';\r\n\r\n/**\r\n * Web Turntable Viewer\r\n * ドラッグ操作で360度回転表示を制御するクラス\r\n */\r\nclass TurntableViewer {\r\n    private container: HTMLElement;\r\n    private iframe: HTMLIFrameElement;\r\n    private dragOverlay: HTMLElement;\r\n    private config: TurntableConfig;\r\n    private state: TurntableState;\r\n    private isReloading: boolean = false;\r\n\r\n    // マネージャークラス\r\n    private progressManager: ProgressManager;\r\n    private videoConfigManager: VideoConfigManager;\r\n    private playerInitializer: PlayerInitializer;\r\n    private dragHandler: DragHandler | null = null;\r\n    private uiManager: UIManager;\r\n\r\n    constructor(containerId: string) {\r\n        // DOM要素の取得\r\n        const container = document.getElementById(containerId);\r\n        if (!container) {\r\n            throw new Error(`Container element with id \"${containerId}\" not found`);\r\n        }\r\n        this.container = container;\r\n\r\n        const iframe = this.container.querySelector<HTMLIFrameElement>('iframe');\r\n        if (!iframe) {\r\n            throw new Error('iframe element not found in container');\r\n        }\r\n        this.iframe = iframe;\r\n\r\n        const angleEl = this.container.querySelector<HTMLElement>('#rotation-angle');\r\n        const angleDisplay = this.container.querySelector<HTMLElement>('#angle-display');\r\n\r\n        const dragOverlay = this.container.querySelector<HTMLElement>('.drag-overlay');\r\n        if (!dragOverlay) {\r\n            throw new Error('drag-overlay element not found in container');\r\n        }\r\n        this.dragOverlay = dragOverlay;\r\n\r\n        // プログレスバー関連要素\r\n        const loadingOverlay = this.container.querySelector<HTMLElement>('.loading-overlay');\r\n        const loadingText = this.container.querySelector<HTMLElement>('.loading-text');\r\n        const progressFill = this.container.querySelector<HTMLElement>('.progress-fill');\r\n        const progressText = this.container.querySelector<HTMLElement>('.progress-text');\r\n\r\n        if (!loadingOverlay || !loadingText || !progressFill || !progressText) {\r\n            throw new Error('Required loading elements not found in container');\r\n        }\r\n\r\n        // ProgressManagerを初期化\r\n        this.progressManager = new ProgressManager(\r\n            this.container,\r\n            this.iframe,\r\n            loadingOverlay,\r\n            loadingText,\r\n            progressFill,\r\n            progressText\r\n        );\r\n\r\n        // DOM要素の存在確認\r\n        console.log('DOM elements check:');\r\n        console.log('- container:', !!this.container);\r\n        console.log('- iframe:', !!this.iframe);\r\n        console.log('- loadingOverlay:', !!loadingOverlay);\r\n        console.log('- progressFill:', !!progressFill);\r\n        console.log('- progressText:', !!progressText);\r\n        console.log('- loadingText:', !!loadingText);\r\n        console.log('- angleEl (optional):', !!angleEl);\r\n        console.log('- angleDisplay (optional):', !!angleDisplay);\r\n\r\n        // 必須要素のチェック\r\n        if (!this.container || !this.iframe || !loadingOverlay) {\r\n            throw new Error('Required elements not found: container, iframe, or loading-overlay');\r\n        }\r\n\r\n        console.log('DOM elements validation passed');\r\n\r\n        // 設定を取得\r\n        try {\r\n            this.config = this.getConfig();\r\n            console.log('Configuration loaded:', this.config);\r\n        } catch (error) {\r\n            const message = getErrorMessage(error);\r\n            console.error('Configuration error:', message);\r\n            this.showError('Configuration Error', message);\r\n            throw error;\r\n        }\r\n\r\n        // 状態管理\r\n        this.state = {\r\n            player: null,\r\n            duration: 0,\r\n            isPlayerReady: false,\r\n            isDragging: false,\r\n            dragStartX: 0,\r\n            startTime: 0,\r\n            lastDragUpdate: 0,\r\n            lastDisplayedAngle: null,\r\n            pendingApiCall: null\r\n        };\r\n\r\n        // マネージャークラスを初期化\r\n        this.videoConfigManager = new VideoConfigManager(this.container, this.iframe, this.config);\r\n        this.playerInitializer = new PlayerInitializer(this.container, this.iframe);\r\n        this.uiManager = new UIManager(\r\n            this.container,\r\n            this.iframe,\r\n            angleEl,\r\n            angleDisplay,\r\n            this.config,\r\n            this.state,\r\n            this.progressManager,\r\n            this.handleReload.bind(this)\r\n        );\r\n\r\n        // 初期化\r\n        this.initialize();\r\n    }\r\n\r\n    /**\r\n     * 設定を取得\r\n     */\r\n    getConfig(): TurntableConfig {\r\n        const videoId = this.container.getAttribute('vimeo-video-id');\r\n        const clockwiseAttr = this.container.getAttribute('clockwise-rotation');\r\n        let isClockwise = true;\r\n\r\n        if (clockwiseAttr !== null) {\r\n            if (clockwiseAttr === '' || clockwiseAttr === 'true' || clockwiseAttr === '1') {\r\n                isClockwise = true;\r\n            } else if (clockwiseAttr === 'false' || clockwiseAttr === '0') {\r\n                isClockwise = false;\r\n            } else {\r\n                console.warn(`Invalid clockwise-rotation attribute value: \"${clockwiseAttr}\". Using default \"true\".`);\r\n                isClockwise = true;\r\n            }\r\n        }\r\n\r\n        if (!videoId) {\r\n            throw new Error('vimeo-video-id attribute is required on the container element');\r\n        }\r\n\r\n        if (!/^\\d+$/.test(videoId)) {\r\n            throw new Error(`Invalid vimeo-video-id format: \"${videoId}\". Only numeric IDs are allowed.`);\r\n        }\r\n\r\n        return {\r\n            RESIZE_DEBOUNCE_MS: 500,\r\n            PLAYER_LOAD_DELAY_MS: 1000,\r\n            DRAG_THROTTLE_MS: 16,\r\n            isClockwise: isClockwise,\r\n            videoId: videoId\r\n        };\r\n    }\r\n\r\n    /**\r\n     * 初期化\r\n     */\r\n    async initialize(): Promise<void> {\r\n        this.uiManager.hideAngleDisplay();\r\n        this.progressManager.showLoadingOverlay();\r\n\r\n        try {\r\n            await this.initializePlayer();\r\n            this.attachEventListeners();\r\n            console.log('TurntableViewer initialized successfully');\r\n\r\n            this.uiManager.showAngleDisplay();\r\n        } catch (error) {\r\n            console.error('TurntableViewer initialization failed:', error);\r\n            this.progressManager.updateProgress(100, '初期化エラーが発生しました');\r\n            this.uiManager.hideLoadingOverlay();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * リロード処理\r\n     */\r\n    async handleReload(): Promise<void> {\r\n        if (this.isReloading) return;\r\n\r\n        this.isReloading = true;\r\n        this.uiManager.setReloadLoading(true);\r\n\r\n        try {\r\n            console.log('Reloading turntable viewer...');\r\n\r\n            // DragHandlerのイベントリスナーを削除\r\n            if (this.dragHandler) {\r\n                this.dragHandler.removeEventListeners();\r\n                this.dragHandler = null;\r\n            }\r\n\r\n            // iframe情報をプレイヤー破棄前に保存（destroy が iframe を削除する可能性があるため）\r\n            if (!this.iframe || !this.iframe.parentElement) {\r\n                console.error('iframe or parent element not found, cannot reload');\r\n                throw new Error('Cannot reload: iframe element not properly initialized');\r\n            }\r\n\r\n            const parent = this.iframe.parentElement;\r\n            const oldId = this.iframe.id;\r\n            const oldClassName = this.iframe.className;\r\n            const oldWidth = this.iframe.getAttribute('width') || '';\r\n            const oldHeight = this.iframe.getAttribute('height') || '';\r\n\r\n            // プレイヤーを破棄\r\n            if (this.state.player) {\r\n                try {\r\n                    await this.state.player.destroy();\r\n                    console.log('Player destroyed successfully');\r\n                } catch (e) {\r\n                    console.warn('Error destroying player:', e);\r\n                }\r\n                this.state.player = null;\r\n            }\r\n\r\n            // 古いiframeを削除（既に destroy で削除されている可能性があるため確認）\r\n            if (this.iframe.parentElement) {\r\n                this.iframe.remove();\r\n                console.log('Old iframe removed');\r\n            } else {\r\n                console.log('iframe already removed by player.destroy()');\r\n            }\r\n\r\n            // 新しいiframe要素を作成\r\n            const newIframe = document.createElement('iframe');\r\n            newIframe.id = oldId;\r\n            newIframe.className = oldClassName;\r\n            newIframe.setAttribute('allow', 'autoplay; fullscreen; picture-in-picture');\r\n            newIframe.setAttribute('loading', 'lazy');\r\n\r\n            // サイズ属性を即座に設定してリサイズを防ぐ\r\n            if (oldWidth) newIframe.setAttribute('width', oldWidth);\r\n            if (oldHeight) newIframe.setAttribute('height', oldHeight);\r\n\r\n            // 新しいiframeを挿入\r\n            parent.appendChild(newIframe);\r\n            this.iframe = newIframe;\r\n            console.log('iframe element recreated with size:', oldWidth, 'x', oldHeight);\r\n\r\n            // マネージャークラスのiframe参照を更新\r\n            this.videoConfigManager = new VideoConfigManager(this.container, this.iframe, this.config);\r\n            this.playerInitializer = new PlayerInitializer(this.container, this.iframe);\r\n\r\n            // 少し待機してブラウザがDOMを更新するのを待つ\r\n            await delay(300);\r\n\r\n            // 状態をリセット\r\n            this.state = {\r\n                player: null,\r\n                duration: 0,\r\n                isPlayerReady: false,\r\n                isDragging: false,\r\n                startTime: 0,\r\n                dragStartX: 0,\r\n                lastDragUpdate: 0,\r\n                pendingApiCall: null,\r\n                lastDisplayedAngle: 0\r\n            };\r\n\r\n            this.progressManager.resetTimeout();\r\n\r\n            // 再初期化\r\n            await this.initialize();\r\n\r\n        } catch (error) {\r\n            console.error('Reload failed:', error);\r\n        } finally {\r\n            this.isReloading = false;\r\n            this.uiManager.setReloadLoading(false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Vimeoプレイヤー初期化\r\n     */\r\n    async initializePlayer(): Promise<void> {\r\n        try {\r\n            // 初期サイズを設定\r\n            await this.videoConfigManager.setInitialSizeFromAPI(\r\n                (progress, message) => {\r\n                    this.progressManager.updateProgress(progress, message);\r\n                },\r\n                () => {\r\n                    this.progressManager.adjustLoadingOverlaySize();\r\n                }\r\n            );\r\n\r\n            // 動画URLを構築してiframeを設定\r\n            this.videoConfigManager.setupVideoPlayer();\r\n\r\n            this.progressManager.updateProgress(20, 'Creating player...');\r\n\r\n            // iframeが新しいURLをロードするまで待機（リロード時は長めに）\r\n            if (this.isReloading) {\r\n                await delay(2000);\r\n                console.log('Extended delay for reload');\r\n            } else {\r\n                await delay(this.config.PLAYER_LOAD_DELAY_MS);\r\n            }\r\n\r\n            // プレイヤーを作成\r\n            this.state.player = await this.playerInitializer.createPlayer((progress, message) => {\r\n                this.progressManager.updateProgress(progress, message);\r\n            });\r\n\r\n            // プレイヤーが完全にロードされるまで待機（リロード時はさらに長めに）\r\n            if (this.isReloading) {\r\n                await delay(2000);\r\n                console.log('Extended player load delay for reload');\r\n            } else {\r\n                await delay(this.config.PLAYER_LOAD_DELAY_MS);\r\n            }\r\n            this.progressManager.updateProgress(60, 'Loading player settings...');\r\n\r\n            // プレイヤーの基本情報取得\r\n            this.state.duration = await this.playerInitializer.getPlayerDuration(\r\n                this.state.player,\r\n                this.isReloading,\r\n                (progress, message) => this.progressManager.updateProgress(progress, message)\r\n            );\r\n\r\n            // 動画のアスペクト比を調整\r\n            await this.playerInitializer.adjustVideoAspectRatio(\r\n                this.state.player,\r\n                () => this.progressManager.adjustLoadingOverlaySize()\r\n            );\r\n\r\n            this.progressManager.updateProgress(75, 'Applying player settings...');\r\n\r\n            // プレイヤー設定を適用\r\n            await this.playerInitializer.applyPlayerSettings(this.state.player);\r\n\r\n            // 動画の事前バッファリング（オプショナル）\r\n            await this.playerInitializer.preloadVideo(\r\n                this.state.player,\r\n                this.state.duration,\r\n                (progress, message) => this.progressManager.updateProgress(progress, message)\r\n            );\r\n\r\n            this.progressManager.updateProgress(90, 'Setting initial state...');\r\n\r\n            // 初期状態設定\r\n            await this.playerInitializer.setInitialPlayerState(this.state.player);\r\n\r\n            // 初期角度表示を更新\r\n            this.uiManager.updateAngle(0);\r\n\r\n            this.state.isPlayerReady = true;\r\n            console.log('Player ready');\r\n\r\n            // プログレス完了\r\n            this.progressManager.updateProgress(100, 'Initialization complete!');\r\n\r\n            // ローディングオーバーレイを隠す\r\n            setTimeout(() => {\r\n                this.uiManager.hideLoadingOverlay();\r\n            }, 500);\r\n\r\n        } catch (error) {\r\n            console.error('Player initialization failed:', error);\r\n\r\n            const errorMessage = getErrorMessage(error);\r\n            if (errorMessage.includes('Failed to create Vimeo player')) {\r\n                this.showError('プレイヤーエラー', 'ビデオプレイヤーを作成できませんでした。接続を確認してリロードしてください。');\r\n            } else if (errorMessage.includes('Video not found')) {\r\n                this.showError('ビデオが見つかりません', '指定されたビデオが見つかりませんでした。ビデオIDを確認してください。');\r\n            } else if (errorMessage.includes('Access denied')) {\r\n                this.showError('アクセス拒否', 'このビデオは非公開または制限されています。ビデオの権限を確認してください。');\r\n            } else if (errorMessage.includes('Failed to get video duration')) {\r\n                this.showError('ビデオ情報の取得に失敗', 'ビデオの長さを取得できませんでした。ネットワーク接続を確認してリロードしてください。');\r\n            } else {\r\n                this.showError('初期化エラー', `ビデオプレイヤーの読み込みに失敗しました。<br><br>エラー: ${errorMessage}<br><br>リロードボタンを押して再試行してください。`);\r\n            }\r\n\r\n            this.videoConfigManager.setInitialSizeFallback(() => {\r\n                this.progressManager.adjustLoadingOverlaySize();\r\n            });\r\n            console.log('Error state maintained, loading overlay not hidden');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * イベントリスナーの追加\r\n     */\r\n    attachEventListeners(): void {\r\n        // DragHandlerを作成\r\n        this.dragHandler = new DragHandler(\r\n            this.container,\r\n            this.dragOverlay,\r\n            this.state,\r\n            this.config,\r\n            () => this.videoConfigManager.calculatePixelsPerRotation(),\r\n            (seconds) => this.uiManager.updateAngle(seconds)\r\n        );\r\n\r\n        this.dragHandler.attachEventListeners();\r\n        window.addEventListener('resize', this.onWindowResize.bind(this));\r\n    }\r\n\r\n    /**\r\n     * ウィンドウリサイズイベントハンドラー\r\n     */\r\n    async onWindowResize(): Promise<void> {\r\n        const newQuality = this.videoConfigManager.selectVideoQuality();\r\n        const currentSrc = this.iframe.src;\r\n\r\n        if (!currentSrc.includes(`quality=${newQuality}`)) {\r\n            console.log('Reinitializing player due to quality change:', newQuality);\r\n            this.state.isPlayerReady = false;\r\n            await this.initializePlayer();\r\n        }\r\n\r\n        const newPixelsPerRotation = this.videoConfigManager.calculatePixelsPerRotation();\r\n        console.log('Window resized, new PIXELS_PER_ROTATION:', newPixelsPerRotation);\r\n    }\r\n\r\n    /**\r\n     * エラー表示（ProgressManagerを使用）\r\n     */\r\n    private showError(title: string, message: string): void {\r\n        this.progressManager.showError(title, message);\r\n    }\r\n\r\n    /**\r\n     * エラー表示（非推奨：後方互換性のため残す）\r\n     */\r\n    private showError_old(title: string, message: string): void {\r\n        this.uiManager.showError(title, message);\r\n    }\r\n\r\n    /**\r\n     * クリーンアップ\r\n     */\r\n    destroy(): void {\r\n        if (this.dragHandler) {\r\n            this.dragHandler.removeEventListeners();\r\n        }\r\n        window.removeEventListener('resize', this.onWindowResize.bind(this));\r\n        console.log('TurntableViewer destroyed');\r\n    }\r\n}\r\n\r\n// グローバルな初期化済みコンテナを追跡\r\nif (!window.turntableViewerInstances) {\r\n    window.turntableViewerInstances = new Set();\r\n}\r\n\r\n// 初期化関数\r\nfunction initializeTurntableViewers(): void {\r\n    const containers = document.querySelectorAll('[vimeo-video-id]');\r\n\r\n    if (containers.length === 0) {\r\n        console.warn('No turntable containers found. Make sure elements have vimeo-video-id attribute.');\r\n        return;\r\n    }\r\n\r\n    console.log(`Found ${containers.length} turntable container(s), checking for new instances...`);\r\n\r\n    containers.forEach((container, index) => {\r\n        try {\r\n            if (!container.id) {\r\n                container.id = `turntable-container-${Date.now()}-${index}`;\r\n                console.log(`Auto-generated ID: ${container.id}`);\r\n            }\r\n\r\n            if (window.turntableViewerInstances.has(container.id)) {\r\n                console.log(`TurntableViewer already initialized for container: ${container.id}`);\r\n                return;\r\n            }\r\n\r\n            new TurntableViewer(container.id);\r\n            window.turntableViewerInstances.add(container.id);\r\n            console.log(`TurntableViewer initialized for container: ${container.id}`);\r\n        } catch (error) {\r\n            console.error(`Failed to initialize TurntableViewer for container ${index}:`, error);\r\n        }\r\n    });\r\n}\r\n\r\n// DOMContentLoadedイベントで初期化\r\ndocument.addEventListener('DOMContentLoaded', initializeTurntableViewers);\r\n\r\n// スクリプトが動的に読み込まれた場合にも対応\r\nif (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', initializeTurntableViewers);\r\n} else {\r\n    initializeTurntableViewers();\r\n}\r\n\r\n// ESモジュールとしてクラスをエクスポート\r\nexport { TurntableViewer };\r\n\r\n// グローバルにも公開(後方互換性のため)\r\nif (typeof window !== 'undefined') {\r\n    window.TurntableViewer = TurntableViewer;\r\n}\r\n"],"names":["ProgressManager","container","iframe","loadingOverlay","loadingText","progressFill","progressText","percentage","text","angleDisplay","iframeWidth","iframeHeight","defaultHeight","now","totalLoadingTime","timeSinceLastProgress","title","message","getErrorMessage","error","delay","ms","resolve","withTimeout","promise","timeoutMs","errorMessage","_","reject","VideoConfigManager","config","htmlWidth","containerWidth","computedWidth","finalWidth","pixelsPerRotation","videoWidth","videoHeight","htmlHeight","finalHeight","area","effectiveArea","devicePixelRatio","effectiveSize","limitedDPR","selectedQuality","quality","screenWidth","_a","availableWidth","params","url","oembedUrl","controller","timeoutId","response","data","aspectRatio","onProgress","onAdjustOverlay","currentWidth","currentHeight","videoInfo","calculatedHeight","calculatedWidth","defaultWidth","videoUrl","PlayerInitializer","player","isReloading","timeout","duration","currentAspectRatio","settings","setting","preloadPoints","i","point","seekTime","actions","action","DragHandler","dragOverlay","state","calculatePixelsPerRotation","onAngleUpdate","deltaX","rotationProgress","timeDelta","currentX","newTime","err","startX","UIManager","angleEl","progressManager","onReload","isLoading","seconds","angle","roundedAngle","wasHidden","vimeoLink","TurntableViewer","containerId","videoId","clockwiseAttr","isClockwise","parent","oldId","oldClassName","oldWidth","oldHeight","e","newIframe","progress","newQuality","newPixelsPerRotation","initializeTurntableViewers","containers","index"],"mappings":"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"}